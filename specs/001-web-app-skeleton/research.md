# Research and Decisions â€“ Web App Skeleton (Modular House MVP)

This document consolidates design choices, rationales, and considered alternatives required to remove all NEEDS CLARIFICATION items from the plan.


## API Framework Version
- Decision: Express 5.x (latest stable major).
- Rationale: Mature/stable; wide middleware support; avoids potential ecosystem churn of pre-/new GA majors.
- Alternatives considered: Express 5.x (if GA), Fastify (perf). Deferred to later phase.

## Dialog/Lightbox Accessibility
- Decision: `@radix-ui/react-dialog` for modal/lightbox.
- Rationale: Robust accessibility defaults, focus management, SSR-friendly, small surface. Works well with plain CSS skinning.
- Alternatives considered: `@reach/dialog` (solid a11y), Headless UI (tight integration but broader dependency surface).

## Email Transport
- Decision: Nodemailer with SMTP. Dev: MailHog; Staging/Prod: domain SMTP (SPF/DKIM configured). Single retry on 5xx; log outcomes.
- Rationale: Simplicity and portability; avoids vendor lock-in; easy local testing.
- Alternatives considered: Mailgun/Sendgrid/SES transports (better deliverability/metrics). Can switch via env without code changes.

## Admin Authentication
- Decision: Email/password with Argon2id hashing, short-lived JWT access tokens (Authorization header), optional refresh tokens deferred.
- Rationale: Stateless API fits SPA; no CSRF for token auth; clear separation of concerns.
- Alternatives considered: Cookie sessions (simpler revocation, CSRF concerns); OAuth (overkill for MVP).

## Rate Limiting Strategy
- Decision: `express-rate-limit` for IP-based window: 10 submissions/hour for `/submissions/*`.
- Rationale: Immediate spam mitigation with minimal setup.
- Alternatives considered: Redis-backed shared limiter for multi-instance; Nginx rate limit. Revisit when horizontally scaling API.

## CSV Export
- Decision: Stream CSV on demand from DB using `csv-stringify` (or `fast-csv`).
- Rationale: Memory-efficient and simple; fits MVP scale.
- Alternatives considered: Pre-generated exports (stale), custom string building (error-prone quoting/escaping).

## Image Storage (Gallery)
- Decision: Local filesystem on droplet with Nginx static serving; 500KB limit per image; validate dimensions/size on upload.
- Rationale: Fast path to value; simplest ops.
- Alternatives considered: S3-compatible object store (DO Spaces). Plan to abstract storage interface for future switch.

## Build Targets & Tooling
- Decision: ES2019+ output; modern browsers; no legacy bundles; Vite for web, ts-node/tsx for dev API.
- Rationale: Modern baseline lowers bundle & polyfill needs.
- Alternatives considered: ES2020; acceptable but ES2019 keeps broader headroom with minimal cost.

## Security Choices
- Decision: Argon2id for password hashing; helmet for headers; strict CORS; input validation (Zod) on all routes; secrets in env; redact sensitive fields in logs.
- Rationale: Aligns with constitution and spec privacy goals.
- Alternatives considered: bcrypt (acceptable, slower/memory characteristics differ), joi/yup for validation.

## Observability
- Decision: Pino structured logs with correlation ID; health endpoint; counters for email send success/failure, rate-limit hits; latencies via logs.
- Rationale: Lightweight and effective for MVP; can evolve to Prometheus later.
- Alternatives considered: Full metrics stack now (Prometheus + Grafana). Deferred to reduce initial complexity.

## Deployment
- Decision: DO droplets: Nginx reverse proxy + PM2 for API; static hosting for SPA; dedicated Postgres droplet with firewall to API.
- Rationale: Clear separation; simple to operate; cost-effective.
- Alternatives considered: Docker Swarm/K8s (overhead), PaaS (Heroku/Fly) (constraints, cost).

## SEO & Privacy Baseline
- Decision: Editable SEO fields per page (title/meta-description); sitemap.xml & robots.txt generated by API; cookie consent banner with local storage of choice.
- Rationale: Meets FR-018 to FR-020 baseline.
- Alternatives considered: External SEO plugins. Not needed for MVP.

All clarifications resolved; no outstanding NEEDS CLARIFICATION remain for Phase 1.
